<h5 class="fw-bold" jhiTranslate="gestProg.home.titleSearchToolbar">Gestione progetti</h5>
<jhi-alert *ngIf="viewDelete"></jhi-alert>
<jhi-alert-error *ngIf="viewError"></jhi-alert-error>
<form [formGroup]="formFilter">
  <div [ngClass]="innerWidth > 820 ? 'row mb-4 mt-4' : 'mb-4 mt-4'">
    <!-- Campo ricerca-->
    <div [ngClass]="innerWidth > 820 ? 'col-3 min-wh-25' : 'w-100 mb-3'">
      <div class="form-group mx-sm-0 mb-0" joyrideStep="firstStepProg" [stepContent]="primoStepProg" stepPosition="bottom">
        <label for="autocomplete" class="visually-hidden">Cerca progetto</label>
        <input
          type="text"
          class="form-control-md"
          name="searchString"
          [placeholder]="'gestProg.home.labelSearchString' | translate"
          formControlName="autocomplete"
          id="autocomplete"
        />
        <span class="autocomplete-icon" aria-hidden="true">
          <svg class="icon icon-sm"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
        </span>
      </div>
    </div>
    <div class="min-wh-25 mt-1" *ngIf="isFetching1">
      <div class="progress-spinner progress-spinner-double size-sm progress-spinner-active">
        <div class="progress-spinner-inner"></div>
        <div class="progress-spinner-inner"></div>
        <span class="visually-hidden">Caricamento...</span>
      </div>
    </div>
    <div class="col-9 d-flex justify-content-end" [ngClass]="innerWidth > 820 ? 'col-9 d-flex justify-content-end' : 'row w-100 mb-3 mx-2'">
      <!-- <div class="d-flex d-grid gap-2 d-md-block justify-content-end"> -->
      <!-- Bottone filtra -->
      <button
        class="btn btn-primary btn-sml btn-xs btn-me min-wh-25"
        [ngClass]="innerWidth < 820 ? 'mb-3' : ''"
        type="button"
        data-bs-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
        joyrideStep="secondStepProg"
        [stepContent]="secondoStepProg"
        stepPosition="bottom"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-list"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelFilter">Filtra</span> <span *ngIf="countFiltri != 0"> ({{ countFiltri }})</span>
      </button>
      <div class="dropdown-menu dismissible w-50" role="menu">
        <div class="container-fluid">
          <div class="row justify-content-between mb-2">
            <div class="col">
              <h5 class="fw-bold" jhiTranslate="entity.filters.title">Filtra ricerca</h5>
            </div>
            <div class="col">
              <button type="button" class="btn-close float-right" data-bs-dismiss="menu" aria-label="Chiudi avviso"></button>
            </div>
          </div>
          <div class="row" (click)="$event.stopPropagation()">
            <div class="col-4">
              <div class="mb-3">
                <label for="tipFin" class="form-label-sm" jhiTranslate="gestProg.tipfin">Tipo finanziamento</label>
                <div class="input-group">
                  <input
                    id="tipFin"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchTipFin"
                    [resultFormatter]="formatterTipFin"
                    [inputFormatter]="formatterTipFin"
                    [editable]="false"
                    formControlName="tipoFinanziamento"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="macroProg" class="form-label-sm" jhiTranslate="gestProg.id_macpro">Macro progetto</label>
                <div class="input-group">
                  <input
                    id="macroProg"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchMacPro"
                    [resultFormatter]="formatterMacPro"
                    [inputFormatter]="formatterMacPro"
                    [editable]="false"
                    formControlName="macroProgetto"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="ban" class="form-label-sm" jhiTranslate="gestProg.id_ban">Bando</label>
                <div class="input-group">
                  <input
                    id="ban"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchBan"
                    [resultFormatter]="formatterBan"
                    [inputFormatter]="formatterBan"
                    [editable]="false"
                    formControlName="bando"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2" (click)="$event.stopPropagation()">
            <div class="col-4">
              <div class="mb-3">
                <label for="tem" class="form-label-sm" jhiTranslate="gestProg.id_tem">Tematica</label>
                <div class="input-group">
                  <input
                    id="tem"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchTem"
                    [resultFormatter]="formatterTem"
                    [inputFormatter]="formatterTem"
                    [editable]="false"
                    formControlName="tematica"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="dir" class="form-label-sm" jhiTranslate="gestProg.id_dir">Direzione</label>
                <div class="input-group">
                  <input
                    id="dir"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchDir"
                    [resultFormatter]="formatterDir"
                    [inputFormatter]="formatterDir"
                    [editable]="false"
                    formControlName="direzione"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-4">
              <label for="defaultSelect" class="form-label-sm" jhiTranslate="gestProg.select.title">Tipo livello</label>
              <div class="select-wrapper">
                <select id="defaultSelect" formControlName="tipLiv">
                  <option selected value="" jhiTranslate="gestProg.select.default">Scegli un'opzione</option>
                  <option value="01" jhiTranslate="gestProg.select.livuno">Livello 1</option>
                  <option value="02" jhiTranslate="gestProg.select.livdue">Livello 2</option>
                  <option value="03" jhiTranslate="gestProg.select.livtre">Livello 3</option>
                  <option value="BA" jhiTranslate="gestProg.select.livba">Livello basso</option>
                  <option value="PB" jhiTranslate="gestProg.select.livpb">Livello prec. al basso</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <div class="mb-3">
                <label for="stateprog" class="form-label-sm" jhiTranslate="gestProg.stateprog">Stato progetto*</label>
                <div class="select-wrapper">
                  <select id="stateprog" formControlName="statoProgetto">
                    <option selected value="null" jhiTranslate="gestProg.select.default">Scegli un'opzione</option>
                    <option *ngFor="let staPro of statPro" [value]="staPro.id">{{ staPro.dessta }}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="statefin" class="form-label-sm" jhiTranslate="gestProg.statefin">Stato finanziario*</label>
                <div class="select-wrapper">
                  <select id="statefin" formControlName="statoFinanziario">
                    <option selected value="null" jhiTranslate="gestProg.select.default">Scegli un'opzione</option>
                    <option *ngFor="let staFin of statFin" [value]="staFin.id">{{ staFin.dessta }}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <button class="btn btn-danger btn-sml btn-xs btn-me h-100 w-100" type="button" (click)="applicaFiltri()">
                <span jhiTranslate="entity.filters.apply">Applica</span>
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary btn-sml btn-xs btn-me h-100 w-100" type="button" (click)="resetFilter()">
                <span jhiTranslate="entity.filters.remove">Rimuovi</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Bottone Esporta -->
      <button
        class="btn btn-primary btn-sml btn-xs btn-me min-wh-25"
        [ngClass]="innerWidth < 820 ? 'mb-3' : ''"
        type="button"
        (click)="exportToCSV()"
        joyrideStep="thirdStepProg"
        [stepContent]="terzoStepProg"
        stepPosition="bottom"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-download"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelExport">Esporta dati</span>
      </button>
      <!-- Bottone inserimento nuovo-->
      <button
        class="btn btn-danger btn-sml btn-xs btn-me min-wh-25"
        [ngClass]="innerWidth < 820 ? 'mb-3' : ''"
        type="button"
        (click)="nuovoUtente()"
        *ngIf="rolesCheckService.isPresent('/inserisciProgetto')"
        joyrideStep="fourthStepProg"
        [stepContent]="quartoStepProg"
        stepPosition="bottom"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-plus"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelNew">Inserisci nuovo</span>
      </button>
    </div>
  </div>

  <!--<div class="table-responsive">   -->
  <!-- <span class="fw-bold" *ngIf="service.loading$ | async" jhiTranslate="global.waitLoad">Attendere...</span> -->
  <!-- Tabella progetti -->
  <div class="alert alert-warning" role="alert" *ngIf="warningMessage != '' && !isFetching">
    {{ warningMessage }}
  </div>
  <jhi-search-spinner *ngIf="isFetching"></jhi-search-spinner>

  <div [ngClass]="innerWidth < 820 ? 'table-responsive mb-4' : ''">
    <table class="table table-borderless table-responsive" *ngIf="!isFetching">
      <thead>
        <tr>
          <th scope="col" sortable="codpro" (sort)="onSort($event)" class="col-1">
            <span jhiTranslate="gestProg.codpro" joyrideStep="fifthStepProg" [stepContent]="quintoStepProg" stepPosition="top">Codice</span>
          </th>
          <th scope="col" sortable="despro" (sort)="onSort($event)">
            <span jhiTranslate="gestProg.despro">Descrizione</span>
          </th>
          <th scope="col" sortable="tipfin" (sort)="onSort($event)" class="col-2">
            <span jhiTranslate="gestProg.tipfin">Tipo finanziamento</span>
          </th>
          <th scope="col" sortable="imprisfon" (sort)="onSort($event)" class="col-1 min-wh-180">
            <span jhiTranslate="gestProg.imprisfonpro" class="float-right">Risorse del fondo app.</span>
          </th>
          <th scope="col" sortable="imprisfon" (sort)="onSort($event)" class="col-1 min-wh-180">
            <span jhiTranslate="gestProg.imprisfon" class="float-right">Risorse del fondo app.</span>
          </th>
          <th scope="col" sortable="staprodessta" (sort)="onSort($event)" class="col-1">
            <span jhiTranslate="gestProg.stateprog">Stato progetto</span>
          </th>
          <th scope="col" sortable="stafindessta" (sort)="onSort($event)" class="col-1 min-wh-180">
            <span jhiTranslate="gestProg.statefin">Stato finanziario</span>
          </th>
        </tr>
      </thead>
      <tbody *ngIf="progetti != null">
        <tr
          *ngFor="let prog of progetti | paginate: config; index as i"
          [ngClass]="[i % 2 == 0 ? 'even border-smoke' : 'odd border-white', innerWidth < 820 ? 'border-left-no-hover' : 'border-left']"
          (click)="apriDettaglio(prog.progetto.id)"
        >
          <td class="txt-sm col-1" [innerHtml]="prog.progetto.codpro | highlight: highlightText"></td>
          <td class="txt-sm" [innerHtml]="prog.progetto.despro | highlight: highlightText"></td>
          <td class="txt-sm col-2">{{ prog.progetto.proTipfinByIdTipfin?.destipfin || '-' }}</td>
          <td class="importo col-1 min-wh-180">{{ prog.totali.imprisfonpro || '0' | number: '1.2' }}</td>
          <td class="importo col-1 min-wh-180">{{ prog.totali.imprisfon || '0' | number: '1.2' }}</td>
          <td class="txt-sm col-1">{{ prog.progetto.proStaproByIdStapro.dessta || '-' }}</td>
          <td class="txt-sm col-1 min-wh-180">{{ prog.progetto.proStafinByIdStafin.dessta || '-' }}</td>
          <td class="col-auto" (click)="$event.stopPropagation()" data-bs-toggle="tooltip" title="Indietro">
            <svg class="icon" (click)="tornaIndietroProcedura()" style="scale: 0.8">
              <use href="content/bootstrap-italia/svg/sprites.svg#it-arrow-left"></use>
            </svg>
          </td>
          <td class="col-auto" (click)="$event.stopPropagation()" data-bs-toggle="tooltip" title="Vai alla procedura">
            <svg class="icon" (click)="vaiAProcedura(prog.progetto.codpro)" style="scale: 0.8">
              <use href="content/bootstrap-italia/svg/sprites.svg#it-arrow-right"></use>
            </svg>
          </td>
        </tr>
        <tr>
          <td *ngIf="progetti.length == 0" class="bold border-white" colspan="6" style="color: gray" jhiTranslate="noRes">
            Nessun risultato trovato
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="progetti != null">
    <nav class="pagination-wrapper justify-content-center" aria-label="Navigazione centrata">
      <!-- <pagination-controls class="my-pagination" [maxSize]="9" previousLabel="" nextLabel="" (pageChange)="pageChanged($event)"></pagination-controls> -->
      <pagination-template #p="paginationApi" (pageChange)="config.currentPage = $event" [maxSize]="9" *ngIf="!isFetching">
        <ul class="pagination custom-pagination">
          <li class="page-item" [class.disabled]="p.isFirstPage()">
            <a class="page-link" (click)="p.previous()" tabindex="-1" aria-hidden="true">
              <svg class="icon icon-primary"><use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-left"></use></svg>
              <span class="visually-hidden" jhiTranslate="page.previous">Pagina precedente</span>
            </a>
          </li>
          <li *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value" class="page-item">
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value" class="page-link">
              <span>{{ page.label }}</span>
            </a>
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() === page.value" class="page-link" aria-current="page">
              <span class="d-inline-block d-sm-none">Pagina </span>{{ page.label }}
            </a>
          </li>
          <li class="page-item pagination-next" [class.disabled]="p.isLastPage()">
            <a class="page-link" (click)="p.next()" tabindex="-1" aria-hidden="true">
              <span class="visually-hidden" jhiTranslate="page.next">Pagina successiva</span>
              <svg class="icon icon-primary"><use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-right"></use></svg>
            </a>
          </li>
        </ul>
        <p class="text-center">Totale {{ p.getTotalItems() }} elementi</p>
      </pagination-template>
    </nav>
  </div>
</form>

<ng-template #primoStepProg>
  <h5 class="card-title h5 px-2">Cerca Progetto</h5>
  <p class="py-2 px-2">Per cercare un progetto, digita del testo nel campo di input</p>
</ng-template>

<ng-template #secondoStepProg>
  <h5 class="card-title h5 px-2">Filtra Progetto</h5>
  <p class="py-2 px-2">Per filtrare un progetto, clicca sul bottone, inserisci i filtri e clicca su applica</p>
</ng-template>

<ng-template #terzoStepProg>
  <h5 class="card-title h5 px-2">Esporta progetti</h5>
  <p class="py-2 px-2">Per esportare la ricerca progetti, clicca sul bottone esporta dati</p>
</ng-template>

<ng-template #quartoStepProg>
  <h5 class="card-title h5 px-2">Inserisci nuovo progetto</h5>
  <p class="py-2 px-2">Per inserire un progetto, clicca sul bottone inserisci nuovo</p>
</ng-template>

<ng-template #quintoStepProg>
  <h5 class="card-title h5 px-2">Ordina colonne</h5>
  <p class="py-2 px-2">
    Per ordinare le colonne della tabella in ordine crescente / decrescente, clicca sul nome della colonna da ordinare
  </p>
</ng-template>

<joyrideStep joyrideStep="sixthStepProg" [stepContent]="sestoStepProg" stepPosition="center"></joyrideStep>

<ng-template #sestoStepProg>
  <h5 class="card-title h5 px-2">Dettaglio progetto</h5>
  <p class="py-2 px-2">Per andare al dettaglio di un progetto, clicca sulla riga di un progetto</p>
</ng-template>
