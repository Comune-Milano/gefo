<h5 class="fw-bold" jhiTranslate="DetCon.home.titleAcc" *ngIf="accertamenti">Accertamenti</h5>
<h5 class="fw-bold" jhiTranslate="DetCon.home.titleImp" *ngIf="!accertamenti">Impegni</h5>
<!--alert modifica / inserimento -->
<jhi-alert *ngIf="viewAlert"></jhi-alert>
<jhi-alert-error *ngIf="viewError"></jhi-alert-error>
<jhi-alert-warning *ngIf="viewWarning"></jhi-alert-warning>
<form [formGroup]="formFilter">
  <div class="d-flex flex-row-reverse mb-4 mt-4">
    <!-- Bottone Esporta -->
    <button
      class="btn btn-primary btn-progress btn-sml btn-xs btn-me min-wh-25"
      type="button"
      (click)="batchService.getIsUpdating() ? '' : aggiornamentoEntitaContabili()"
      *ngIf="!prog && rolesCheckService.isPresent('/aggiornamentoEntitaContabili')"
    >
      <svg class="icon icon-white" *ngIf="!batchService.getIsUpdating()">
        <use href="content/bootstrap-italia/svg/sprites.svg#it-restore"></use>
      </svg>
      <span *ngIf="!batchService.getIsUpdating()">Aggiorna entità contabili</span>
      <span *ngIf="batchService.getIsUpdating()">Aggiornamento entità contabili in corso ...</span>
      <div class="progress progress-indeterminate" *ngIf="batchService.getIsUpdating()">
        <span class="visually-hidden">In elaborazione...</span>
        <div class="progress-bar" role="progressbar"></div>
      </div>
    </button>
    <!-- Bottone Esporta -->
    <button class="btn btn-primary btn-sml btn-xs btn-me min-wh-25" type="button" (click)="exportToCSV()">
      <svg class="icon icon-white">
        <use href="content/bootstrap-italia/svg/sprites.svg#it-download"></use>
      </svg>
      <span jhiTranslate="global.buttons.labelExport">Esporta dati</span>
    </button>
    <!-- Bottone filtra -->
    <button
      class="btn btn-primary btn-sml btn-xs btn-me min-wh-25"
      type="button"
      data-bs-toggle="dropdown"
      href="#dropdownAcc"
      aria-haspopup="true"
      aria-expanded="false"
      (click)="showFilterAcc()"
      *ngIf="!prog"
    >
      <svg class="icon icon-white">
        <use href="content/bootstrap-italia/svg/sprites.svg#it-list"></use>
      </svg>
      <span jhiTranslate="global.buttons.labelFilter">Filtra</span> <span *ngIf="countFiltri != 0"> ({{ countFiltri }})</span>
    </button>
    <div class="dropdown-menu dismissible w-50" role="menuAcc" id="dropdownAcc" [ngClass]="{ show: shPanAcc }">
      <div class="container-fluid">
        <div class="row justify-content-between mb-2">
          <div class="col">
            <h5 class="fw-bold" jhiTranslate="entity.filters.title">Filtra ricerca</h5>
          </div>
          <div class="col">
            <button
              type="button"
              class="btn-close float-right"
              data-bs-dismiss="menuAcc"
              data-bs-toggle="collapse"
              href="#dropdownAcc"
              aria-label="Chiudi avviso"
              (click)="shPanAcc = false"
            ></button>
          </div>
        </div>
        <div class="row" (click)="$event.stopPropagation()">
          <div class="col-4">
            <div class="mb-3">
              <label for="id" class="form-label-sm" jhiTranslate="DetCon.id">Codice</label>
              <input id="id" type="text" class="form-control" formControlName="id" />
            </div>
          </div>
          <div class="col-4">
            <div class="mb-3">
              <label for="desimp" class="form-label-sm" jhiTranslate="DetCon.desimp">Descrizione</label>
              <input id="desimp" type="text" class="form-control" formControlName="descrizione" />
            </div>
          </div>
          <div class="col-4">
            <div class="mb-3">
              <label for="ban" class="form-label-sm" jhiTranslate="DetCon.idcap">Capitolo</label>
              <input id="ban" type="text" class="form-control" formControlName="id_capitolo" />
            </div>
          </div>
        </div>
        <div class="row mb-2" (click)="$event.stopPropagation()">
          <div class="col-4">
            <div class="mb-3">
              <label for="idcro" class="form-label-sm" jhiTranslate="DetCon.idcro">Crono</label>
              <input id="idcro" type="text" class="form-control" formControlName="id_crono" />
            </div>
          </div>
          <div class="col-4">
            <div class="mb-3">
              <label for="cup" class="form-label-sm" jhiTranslate="DetCon.cup">CUP</label>
              <input id="cup" type="text" class="form-control" formControlName="cup" />
            </div>
          </div>
          <div class="col-4 mb-3">
            <label for="cig" class="form-label-sm" jhiTranslate="DetCon.cig">CIG</label>
            <input id="cig" type="text" class="form-control" formControlName="cig" />
          </div>
        </div>
        <div class="row mb-2">
          <div class="col-4 mb-3">
            <label for="anno" class="form-label-sm">Anno</label>
            <input id="anno" type="text" class="form-control" formControlName="anno" />
          </div>
          <div class="col-4 mb-3" *ngIf="prog">
            <label for="prog" class="form-label-sm" jhiTranslate="DetCon.prog">Progetto</label>
            <input id="prog" type="text" class="form-control" />
          </div>
        </div>
        <div class="row">
          <div class="col-4">
            <button
              class="btn btn-danger btn-sml btn-xs btn-me h-100 w-100"
              type="button"
              [disabled]="!formFilter.valid"
              (click)="applicaFiltri()"
            >
              <span jhiTranslate="entity.filters.apply">Applica</span>
            </button>
          </div>
          <div class="col-4">
            <button class="btn btn-primary btn-sml btn-xs btn-me h-100 w-100" type="button" (click)="resetFilter()">
              <span jhiTranslate="entity.filters.remove">Rimuovi</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--<div class="table-responsive">   -->
  <!-- <span class="fw-bold" *ngIf="service.loading$ | async" jhiTranslate="global.waitLoad">Attendere...</span> -->
  <!-- Tabella ruoli -->
  <div class="alert alert-warning" role="alert" *ngIf="warningMessage != '' && !isFetching">
    {{ warningMessage }}
  </div>
  <jhi-search-spinner *ngIf="isFetching"></jhi-search-spinner>

  <table class="table table-borderless table-responsive" *ngIf="!isFetching">
    <thead>
      <tr>
        <th scope="col" sortable="codentcon" (sort)="onSort($event)" *ngIf="accertamenti">
          <span jhiTranslate="DetCon.idAcc">Accertamento</span>
        </th>
        <th scope="col" sortable="codentcon" (sort)="onSort($event)" *ngIf="!accertamenti">
          <span jhiTranslate="DetCon.idImp">Impegno</span>
        </th>
        <th scope="col" sortable="desimp" (sort)="onSort($event)" class="min-wh-250">
          <span jhiTranslate="DetCon.desimp">Descrizione</span>
        </th>
        <th scope="col" sortable="idcap" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.idcap">Capitolo</span>
        </th>
        <th scope="col" sortable="impass" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.impass">Assestato</span>
        </th>
        <th scope="col" sortable="impeco" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.impeco">Economie</span>
        </th>
        <th scope="col" sortable="impliq" (sort)="onSort($event)" *ngIf="!accertamenti">
          <span jhiTranslate="DetCon.impliq">Liquidato</span>
        </th>
        <th scope="col" sortable="impman" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.impmanRev" *ngIf="accertamenti">Reversali</span>
          <span jhiTranslate="DetCon.impmanMan" *ngIf="!accertamenti">Mandati</span>
        </th>
        <th scope="col" sortable="despdd" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.despdd">PDD</span>
        </th>
        <th scope="col" sortable="idcro" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.idcro">Crono</span>
        </th>
        <th scope="col" sortable="codcup" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.cup">CUP</span>
        </th>
        <th scope="col" sortable="codcig" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.cig">CIG</span>
        </th>
        <th scope="col" sortable="codcig" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.nroconapp">Num. Con. App</span>
        </th>
        <th scope="col" sortable="codcig" (sort)="onSort($event)">
          <span jhiTranslate="DetCon.codgami">Codice Gami</span>
        </th>
      </tr>
    </thead>
    <tbody *ngIf="entCon != null">
      <tr
        *ngFor="let ent of entCon | paginate: config; index as i"
        [ngClass]="i % 2 == 0 ? 'even border-smoke border-left' : 'odd border-white border-left'"
        (click)="setCodiceAccImp(ent.codentcon)"
      >
        <td>{{ ent.codentcon }}</td>
        <td class="min-wh-250">{{ ent.desimp }}</td>
        <td>{{ ent.idcap }}</td>
        <td class="text-end">{{ ent.impass | number: '1.2' }}</td>
        <td class="text-end">{{ ent.impeco | number: '1.2' }}</td>
        <td class="text-end" *ngIf="!accertamenti">{{ ent.impliq | number: '1.2' }}</td>
        <td class="text-end">{{ ent.impman | number: '1.2' }}</td>
        <td>{{ ent.despdd }}</td>
        <td>{{ ent.idcro }}</td>
        <td>{{ ent.codcup || '-' }}</td>
        <td>{{ ent.codcig || '-' }}</td>
        <td class="text-end">{{ ent.nroconapp }}</td>
        <td>{{ ent.codgami || '-' }}</td>
      </tr>
      <tr>
        <td *ngIf="entCon.length == 0" class="bold border-white" colspan="6" style="color: gray" jhiTranslate="noRes">
          Nessun risultato trovato
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="entCon != null">
    <nav class="pagination-wrapper justify-content-center" aria-label="Navigazione centrata">
      <!-- <pagination-controls class="my-pagination" [maxSize]="9" previousLabel="" nextLabel="" (pageChange)="pageChanged($event)"></pagination-controls> -->
      <pagination-template #p="paginationApi" (pageChange)="config.currentPage = $event" [maxSize]="9">
        <ul class="pagination custom-pagination">
          <li class="page-item" [class.disabled]="p.isFirstPage()">
            <a class="page-link" (click)="p.previous()" tabindex="-1" aria-hidden="true">
              <svg class="icon icon-primary"><use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-left"></use></svg>
              <span class="visually-hidden" jhiTranslate="page.previous">Pagina precedente</span>
            </a>
          </li>
          <li *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value" class="page-item">
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value" class="page-link">
              <span>{{ page.label }}</span>
            </a>
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() === page.value" class="page-link" aria-current="page">
              <span class="d-inline-block d-sm-none">Pagina </span>{{ page.label }}
            </a>
          </li>
          <li class="page-item pagination-next" [class.disabled]="p.isLastPage()">
            <a class="page-link" (click)="p.next()" tabindex="-1" aria-hidden="true">
              <span class="visually-hidden" jhiTranslate="page.next">Pagina successiva</span>
              <svg class="icon icon-primary"><use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-right"></use></svg>
            </a>
          </li>
        </ul>
        <p class="text-center">Totale {{ p.getTotalItems() }} elementi</p>
      </pagination-template>
    </nav>
  </div>
</form>
