<h5 class="fw-bold" jhiTranslate="tipFin.home.titleSearchToolbar">Gestione tipi finanziamento</h5>
<jhi-alert *ngIf="viewDelete"></jhi-alert>
<jhi-alert-error *ngIf="viewError"></jhi-alert-error>
<form [formGroup]="formFilter">
  <div class="row mb-4 mt-4">
    <!-- Campo ricerca-->
    <div class="col-3">
      <div class="form-group mx-sm-0 mb-0">
        <label for="autocomplete" class="visually-hidden">Cerca ruoli</label>
        <input
          type="text"
          class="form-control-md"
          name="searchString"
          [placeholder]="'tipFin.home.labelSearchString' | translate"
          formControlName="autocomplete"
          id="autocomplete"
        />
        <span class="autocomplete-icon" aria-hidden="true">
          <svg class="icon icon-sm"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
        </span>
      </div>
    </div>
    <div class="col mt-1" *ngIf="isFetching1">
      <div class="progress-spinner progress-spinner-double size-sm progress-spinner-active">
        <div class="progress-spinner-inner"></div>
        <div class="progress-spinner-inner"></div>
        <span class="visually-hidden">Caricamento...</span>
      </div>
    </div>
    <div class="col-7 offset-1 d-flex justify-content-end" [ngClass]="isFetching1 ? '' : 'offset-md-2'">
      <!-- Bottone filtra -->
      <button
        class="btn btn-primary btn-sml btn-xs btn-me h-100 w-100"
        type="button"
        data-bs-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-list"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelFilter">Filtra</span> <span *ngIf="countFiltri != 0"> ({{ countFiltri }})</span>
      </button>
      <div class="dropdown-menu dismissible w-50" role="menu">
        <div class="container-fluid">
          <div class="row justify-content-between mb-2">
            <div class="col">
              <h5 class="fw-bold" jhiTranslate="entity.filters.title">Filtra ricerca</h5>
            </div>
            <div class="col">
              <button type="button" class="btn-close float-right" data-bs-dismiss="menu" aria-label="Chiudi avviso"></button>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <div class="mb-3">
                <label for="liv1" class="form-label-sm" jhiTranslate="tipFin.livuno">Livello 1</label>
                <input type="number" class="form-control" id="liv1" value="liv1" formControlName="liv1" min="1" placeholder=" " />
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="liv2" class="form-label-sm" jhiTranslate="tipFin.livdue">Livello 2</label>
                <input type="number" class="form-control" id="liv2" value="liv2" formControlName="liv2" min="1" placeholder=" " />
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="liv3" class="form-label-sm" jhiTranslate="tipFin.livtre">Livello 3</label>
                <input type="number" class="form-control" id="liv3" value="liv3" formControlName="liv3" min="1" placeholder=" " />
              </div>
            </div>
          </div>
          <div class="row mb-2">
            <div class="col-4">
              <label for="liv4" class="form-label-sm" jhiTranslate="tipFin.livqua">Livello 4</label>
              <input type="number" class="form-control" id="liv4" formControlName="liv4" value="liv4" min="1" placeholder=" " />
            </div>
            <div class="col-4">
              <label for="liv5" class="form-label-sm" jhiTranslate="tipFin.livcin">Livello 4</label>
              <input type="number" class="form-control" id="liv5" formControlName="liv5" value="liv5" min="1" placeholder=" " />
            </div>
            <div class="col-4">
              <label for="defaultSelect" class="form-label-sm" jhiTranslate="tipFin.select.title">Livello</label>
              <div class="select-wrapper">
                <select id="defaultSelect" formControlName="tipLiv">
                  <option value="" jhiTranslate="tipFin.select.default">Scegli un'opzione</option>
                  <option value="01" jhiTranslate="tipFin.livuno">Livello 1</option>
                  <option value="02" jhiTranslate="tipFin.livdue">Livello 2</option>
                  <option value="03" jhiTranslate="tipFin.livtre">Livello 3</option>
                  <option value="04" jhiTranslate="tipFin.livqua">Livello 4</option>
                  <option value="05" jhiTranslate="tipFin.livcin">Livello 5</option>
                  <option value="06" jhiTranslate="tipFin.livsei">Livello 6</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <button
                class="btn btn-danger btn-sml btn-xs btn-me h-100 w-100"
                type="button"
                [disabled]="formFilter.pristine || !formFilter.valid"
                (click)="applicaFiltri()"
              >
                <span jhiTranslate="entity.filters.apply">Applica</span>
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary btn-sml btn-xs btn-me h-100 w-100" type="button" (click)="resetFilter()">
                <span jhiTranslate="entity.filters.remove">Rimuovi</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Bottone Esporta -->
      <button class="btn btn-primary btn-sml btn-xs btn-me h-100 w-100" type="button" (click)="exportToCSV()">
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-download"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelExport">Esporta dati</span>
      </button>
      <!-- Bottone inserimento nuovo-->
      <button
        class="btn btn-danger btn-sml btn-xs btn-me h-100 w-100"
        type="button"
        (click)="nuovoTipFin()"
        *ngIf="rolesCheckService.isPresent('/inserisciTipoFinanziamento')"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-plus"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelNew">Inserisci nuovo</span>
      </button>
    </div>
  </div>

  <!-- Tabella tipi finanziamento -->
  <div class="alert alert-warning" role="alert" *ngIf="warningMessage != '' && !isFetching">
    {{ warningMessage }}
  </div>
  <jhi-search-spinner *ngIf="isFetching"></jhi-search-spinner>

  <table class="table table-borderless table-responsive" *ngIf="!isFetching">
    <caption class="d-none">
      Tabella tipi finanziamento
    </caption>
    <thead>
      <tr>
        <th scope="col" sortable="codtipfin" (sort)="onSort($event)" class="col-1">
          <span jhiTranslate="tipFin.codtipfin">Codice</span>
        </th>
        <th scope="col" sortable="destipfin" (sort)="onSort($event)" class="col-2 min-wh-180">
          <span jhiTranslate="tipFin.destipfin">Descrizione</span>
        </th>
        <th scope="col" sortable="nroprofon" (sort)="onSort($event)" class="col-1">
          <span jhiTranslate="tipFin.num_progetti">Num. Progetti</span>
        </th>
        <th scope="col" sortable="imprisfon" (sort)="onSort($event)" class="col-1 min-wh-180">
          <span jhiTranslate="tipFin.resources">Risorse del fondo</span>
        </th>
        <th scope="col" sortable="impimp" (sort)="onSort($event)" class="col-1 importo">
          <span jhiTranslate="tipFin.impimp">Impegni</span>
        </th>
        <th scope="col" sortable="impigv" (sort)="onSort($event)" class="col-auto importo">
          <span jhiTranslate="tipFin.impigv">Importo IGV nel SI</span>
        </th>
        <th scope="col" sortable="impddr" (sort)="onSort($event)" class="col-auto importo">
          <span jhiTranslate="tipFin.impddr">DDR</span>
        </th>
        <th scope="col" sortable="impinc" (sort)="onSort($event)" class="col-auto importo">
          <span jhiTranslate="tipFin.impinc">Introitato</span>
        </th>
        <th scope="col" class="col-auto"></th>
        <th scope="col" class="col-auto"></th>
        <th scope="col" class="col-auto"></th>
      </tr>
    </thead>
    <tbody *ngIf="tipFinanziamenti != null">
      <tr
        *ngFor="let tipFin of tipFinanziamenti | paginate: config; index as i"
        [ngClass]="i % 2 == 0 ? 'even border-smoke border-left' : 'odd border-white border-left'"
        (click)="apriDettaglio(tipFin.tipoFinanziamento.id)"
      >
        <td class="txt-sm col-1" [innerHtml]="tipFin.tipoFinanziamento.codtipfin | highlight: highlightText"></td>
        <td class="txt-sm col-2 min-wh-180" [innerHtml]="tipFin.tipoFinanziamento.destipfin | highlight: highlightText"></td>
        <td class="importo col-1">{{ tipFin.totali.nroprofon || '0' | number }}</td>
        <td class="importo col-1 min-wh-180">{{ tipFin.totali.imprisfon || '0' | number: '1.2' }}</td>
        <td class="importo col-1">{{ tipFin?.totaliImpegni?.impimp || '0' | number: '1.2' }}</td>
        <td class="importo col-auto min-wh-130">{{ tipFin?.totaliImpegni?.impigvdel || '0' | number: '1.2' }}</td>
        <td class="importo col-auto min-wh-130">{{ tipFin?.totaliDdr?.impddr || '0' | number: '1.2' }}</td>
        <td class="importo col-auto min-wh-130">{{ tipFin?.totaliDdr?.impinc || '0' | number: '1.2' }}</td>
        <td class="col-auto" (click)="$event.stopPropagation()" data-bs-toggle="tooltip" title="indietro">
          <svg class="icon" (click)="tornaIndietro(tipFin.tipoFinanziamento)" style="scale: 0.8">
            <use href="content/bootstrap-italia/svg/sprites.svg#it-arrow-left"></use>
          </svg>
        </td>
        <td class="col-auto" (click)="$event.stopPropagation()" data-bs-toggle="tooltip" title="avanti" *ngIf="tipFin.hasChild">
          <svg class="icon" (click)="vaiAvanti(tipFin.tipoFinanziamento)" style="scale: 0.8">
            <use href="content/bootstrap-italia/svg/sprites.svg#it-arrow-right"></use>
          </svg>
        </td>
        <td class="col-auto" *ngIf="!tipFin.hasChild">-</td>
        <td class="col-auto" (click)="$event.stopPropagation()" data-bs-toggle="tooltip" title="Elenco progetti">
          <svg class="icon py-1" (click)="goToProg(tipFin.tipoFinanziamento)">
            <use href="content/bootstrap-italia/svg/sprites.svg#it-external-link"></use>
          </svg>
        </td>
      </tr>
      <tr>
        <td *ngIf="tipFinanziamenti.length == 0" class="bold border-white" colspan="6" style="color: gray" jhiTranslate="noRes">
          Nessun risultato trovato
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="tipFinanziamenti != null">
    <nav class="pagination-wrapper justify-content-center" aria-label="Navigazione centrata">
      <pagination-template #p="paginationApi" (pageChange)="config.currentPage = $event" [maxSize]="9">
        <ul class="pagination custom-pagination">
          <li class="page-item" [class.disabled]="p.isFirstPage()">
            <a class="page-link" (click)="p.previous()" tabindex="-1" aria-hidden="true">
              <svg class="icon icon-primary"><use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-left"></use></svg>
              <span class="visually-hidden" jhiTranslate="page.previous">Pagina precedente</span>
            </a>
          </li>
          <li *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value" class="page-item">
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value" class="page-link">
              <span>{{ page.label }}</span>
            </a>
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() === page.value" class="page-link" aria-current="page">
              <span class="d-inline-block d-sm-none">Pagina </span>{{ page.label }}
            </a>
          </li>
          <li class="page-item pagination-next" [class.disabled]="p.isLastPage()">
            <a class="page-link" (click)="p.next()" tabindex="-1" aria-hidden="true">
              <span class="visually-hidden" jhiTranslate="page.next">Pagina successiva</span>
              <svg class="icon icon-primary"><use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-right"></use></svg>
            </a>
          </li>
        </ul>
        <p class="text-center">Totale {{ p.getTotalItems() }} elementi</p>
      </pagination-template>
    </nav>
  </div>
</form>
