<div class="container-fluid mt-4">
  <div class="row justify-content-between mb-1">
    <div class="col d-flex align-items-center">
      <h5 class="bold"><span jhiTranslate="gestProg.detail.titleAvanzamento">Avanzamenti</span></h5>
    </div>
  </div>
  <!--alert modifica / inserimento -->
  <jhi-alert *ngIf="viewDelete"></jhi-alert>
  <jhi-alert-error *ngIf="viewError"></jhi-alert-error>
  <!--<jhi-alert *ngIf="viewAlert"></jhi-alert> -->
  <!-- <jhi-alert-error *ngIf="viewError"></jhi-alert-error>-->

  <form [formGroup]="formFilter">
    <div class="d-flex flex-row-reverse mb-4 mt-4">
      <!-- Bottone inserisci nuovo -->
      <button
        class="btn btn-danger btn-sml btn-xs btn-me min-wh-25"
        type="button"
        (click)="nuovoAvanzamento()"
        *ngIf="rolesCheckService.isPresent('/inserisciAvanzamento')"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-plus"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelNew">Inserisci nuovo</span>
      </button>
      <!-- Bottone Esporta -->
      <button class="btn btn-primary btn-sml btn-xs btn-me min-wh-25" type="button" (click)="exportToCSV()">
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-download"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelExport">Esporta dati</span>
      </button>
      <!-- Bottone filtra -->
      <button
        class="btn btn-primary btn-sml btn-xs btn-me min-wh-25"
        type="button"
        data-bs-toggle="dropdown"
        href="#dropdownAcc"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <svg class="icon icon-white">
          <use href="content/bootstrap-italia/svg/sprites.svg#it-list"></use>
        </svg>
        <span jhiTranslate="global.buttons.labelFilter">Filtra</span> <span *ngIf="countFiltri != 0"> ({{ countFiltri }})</span>
      </button>
      <div class="dropdown-menu dismissible w-50" role="menuAcc" id="dropdownAcc">
        <div class="container-fluid">
          <div class="row justify-content-between mb-2">
            <div class="col">
              <h5 class="fw-bold" jhiTranslate="entity.filters.title">Filtra ricerca</h5>
            </div>
            <div class="col">
              <button
                type="button"
                class="btn-close float-right"
                data-bs-dismiss="menuAcc"
                data-bs-toggle="collapse"
                href="#dropdownAcc"
                aria-label="Chiudi avviso"
              ></button>
            </div>
          </div>
          <div class="row" (click)="$event.stopPropagation()">
            <div class="col-4">
              <div class="mb-3">
                <label for="progetto" class="form-label-sm">Progetto</label>
                <div class="input-group">
                  <input
                    id="progetto"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchPro"
                    [resultFormatter]="formatterPro"
                    [inputFormatter]="formatterPro"
                    [editable]="false"
                    formControlName="progetto"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="tipLiv" class="form-label-sm">Livello</label>
                <div class="select-wrapper">
                  <select id="tipLiv" formControlName="tipliv">
                    <option selected value="" jhiTranslate="gestProg.select.default">Scegli un'opzione</option>
                    <option value="01" jhiTranslate="gestProg.select.livuno">Livello 1</option>
                    <option value="02" jhiTranslate="gestProg.select.livdue">Livello 2</option>
                    <option value="03" jhiTranslate="gestProg.select.livtre">Livello 3</option>
                    <option value="BA" jhiTranslate="gestProg.select.livba">Livello basso</option>
                    <option value="PB" jhiTranslate="gestProg.select.livpb">Livello prec. al basso</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="tipFin" class="form-label-sm">Tipo finanziamento</label>
                <div class="input-group">
                  <input
                    id="tipFin"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchTipFin"
                    [resultFormatter]="formatterTipFin"
                    [inputFormatter]="formatterTipFin"
                    [editable]="false"
                    formControlName="tipFin"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2" (click)="$event.stopPropagation()">
            <div class="col-4">
              <div class="mb-3">
                <label for="idDir" class="form-label-sm">Direzione</label>
                <div class="input-group">
                  <input
                    id="idDir"
                    type="text"
                    class="form-control"
                    [ngbTypeahead]="searchDir"
                    [resultFormatter]="formatterDir"
                    [inputFormatter]="formatterDir"
                    [editable]="false"
                    formControlName="direzione"
                  />
                  <span class="autocomplete-icon" aria-hidden="true">
                    <svg class="icon icon-xs"><use href="content/bootstrap-italia/svg/sprites.svg#it-search"></use></svg>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="mb-3">
                <label for="tipAva" class="form-label-sm">Tipo avanzamento</label>
                <div class="select-wrapper">
                  <select id="tipAva" formControlName="tipava">
                    <option selected value="A">Avanzamento</option>
                    <option value="V">Versioni precedenti</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <button
                class="btn btn-danger btn-sml btn-xs btn-me h-100 w-100"
                type="button"
                [disabled]="formFilter.pristine || !formFilter.valid"
                (click)="applicaFiltri()"
              >
                <span jhiTranslate="entity.filters.apply">Applica</span>
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary btn-sml btn-xs btn-me h-100 w-100" type="button">
                <span jhiTranslate="entity.filters.remove">Rimuovi</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <!-- Tabella progetti -->
  <div class="alert alert-warning" role="alert" *ngIf="warningMessage != '' && !isFetching">
    {{ warningMessage }}
  </div>
  <jhi-search-spinner *ngIf="isFetching"></jhi-search-spinner>

  <table class="table table-borderless table-responsive" *ngIf="!isFetching">
    <thead>
      <tr>
        <th scope="col" sortable="codpro" class="col-4"><span jhiTranslate="proAva.prog">Progetto</span></th>
        <th scope="col" sortable="despro" class="col-1">
          <span jhiTranslate="proAva.dtarilava">Data ril.</span>
        </th>
        <th scope="col" sortable="tipfin" class="col-2">
          <span jhiTranslate="proAva.desstaava">Stato avanzamanento</span>
        </th>
        <th scope="col" sortable="imprisfon" class="col-1 min-wh-180">
          <span jhiTranslate="proAva.vallisfasint">Fase intervento</span>
        </th>
        <th scope="col" sortable="staprodessta" class="col-1">
          <span jhiTranslate="proAva.vallislivcri">Livello criticit√†</span>
        </th>
        <th scope="col" sortable="stafindessta" class="col-1 text-center min-wh-180">
          <span jhiTranslate="proAva.semaforo">Semaforo</span>
        </th>
      </tr>
    </thead>
    <tbody *ngIf="avanzamenti != null">
      <tr
        *ngFor="let ava of avanzamenti | paginate: config; index as i"
        [ngClass]="i % 2 == 0 ? 'even border-smoke border-left' : 'odd border-white border-left'"
        (click)="apriDettaglio(ava.avanzamento.id)"
      >
        <td class="txt-sm col-4">{{ ava.codDesProgetto || '-' }}</td>
        <td class="txt-sm col-1">{{ ava.avanzamento.dtarilava || '-' | date: 'MM/dd/yyyy' }}</td>
        <td class="txt-sm col-1">{{ ava.avanzamento.desstaava || '-' }}</td>
        <td class="txt-sm col-1">{{ ava.faseIntervento.vallis || '-' }}</td>
        <td class="txt-sm col-1">{{ ava.livelloCriticita.vallis || '-' }}</td>
        <td class="text-center" *ngIf="ava.semaforoAvanzamento.colore != 'bianco'">
          <!--    <svg
            width="27px"
            height="27px"
            viewBox="-2.4 -2.4 28.80 28.80"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            stroke="#000000"
            stroke-width="0.40800000000000003"
            stroke-linecap="round"
            stroke-linejoin="miter"
          >
            <g id="SVGRepo_bgCarrier" stroke-width="0" />

            <g id="SVGRepo_iconCarrier">
              <circle cx="12" cy="12" r="10" />

              <circle cx="12" cy="12" r="10" [attr.fill]="dizionarioColori.get(ava.semaforoAvanzamento.colore)" opacity="1" />
            </g>
          </svg> -->
          <img [src]="'/content/images/semaforo/' + ava.semaforoAvanzamento.colore + '.png'" width="24px" />
        </td>
        <td class="text-center bold" *ngIf="ava.semaforoAvanzamento.colore == 'bianco'">N.D.</td>
      </tr>
      <tr>
        <td *ngIf="avanzamenti.length == 0" class="bold border-white" colspan="6" style="color: gray" jhiTranslate="noRes">
          Nessun risultato trovato
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="avanzamenti != null">
    <nav class="pagination-wrapper justify-content-center" aria-label="Navigazione centrata">
      <!-- <pagination-controls class="my-pagination" [maxSize]="9" previousLabel="" nextLabel="" (pageChange)="pageChanged($event)"></pagination-controls> -->
      <pagination-template #p="paginationApi" (pageChange)="config.currentPage = $event" [maxSize]="9">
        <ul class="pagination custom-pagination">
          <li class="page-item" [class.disabled]="p.isFirstPage()">
            <a class="page-link" (click)="p.previous()" tabindex="-1" aria-hidden="true">
              <svg class="icon icon-primary">
                <use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-left"></use>
              </svg>
              <span class="visually-hidden" jhiTranslate="page.previous">Pagina precedente</span>
            </a>
          </li>
          <li *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value" class="page-item">
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value" class="page-link">
              <span>{{ page.label }}</span>
            </a>
            <a (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() === page.value" class="page-link" aria-current="page">
              <span class="d-inline-block d-sm-none">Pagina </span>{{ page.label }}
            </a>
          </li>
          <li class="page-item pagination-next" [class.disabled]="p.isLastPage()">
            <a class="page-link" (click)="p.next()" tabindex="-1" aria-hidden="true">
              <span class="visually-hidden" jhiTranslate="page.next">Pagina successiva</span>
              <svg class="icon icon-primary">
                <use href="content/bootstrap-italia/svg/sprites.svg#it-chevron-right"></use>
              </svg>
            </a>
          </li>
        </ul>
        <p class="text-center">Totale {{ p.getTotalItems() }} elementi</p>
      </pagination-template>
    </nav>
  </div>
</div>
